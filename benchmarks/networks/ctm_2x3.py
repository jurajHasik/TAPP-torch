class TN_CTM_2X3():
    r"""
    # C1------(1)1 1(0)----T1----(3)44 44(0)----T1_x----(3)39 39(0)---T1_2x---(3)24 24(0)--C2_2x
    # 0(0)               (1,2)                 (1,2)                  (1,2)                25(1)
    # 0(0)           100  2  5             102 40 42              104 26 28                25(0)
    # |                 \ 2  5               \ |  |                  \ |  |                 |
    # T4-------(2)3 3-----a--|------45 45----a_x--6(1)----41  41-------a_2x-------27 27(1)--T2_2x
    # |                   |  |                 |  |                    |  |                 |
    # |        (3)6 6-------a*------46 46--------a*_x-----43  43----------a*_2x---29 29(2)  |
    # 15(1)               16 17 \101          47 48 \103               37 38 \105          36(3)
    # 15(0)          106  16 17           108 47 48                    37 38               36(0)
    # |                 \ |   |              \ |  |               110\ |  |                 |
    # T4_y--(2)9 9--------a_y-------20 20-----a_xy--------49 49(1)----a_2xy-------33 33(1)--T2_2xy
    # |                   |   |                |  |                    |  |                 |
    # |     (3)12 12---------a*_y---22 22------- a*_xy----50 50(2)--------a*_2xy--35 35(2)  |
    # |                   10 13 \107           21 23 \109             32 34 \111            |
    # 8(1)                10 13                21 23                  32 34                 31(3)
    # 8(0)                (0,1)                (0,1)                  (0,1)                 31(0)
    # C4_y---(1)7 7(2)-----T3_y--(3)19 19(2)----T3_xy---(3)51 51(2)---T3_2xy--(3)30 30(1)---C3_2xy
    """
    idx_dims= { "D": [2,3,16,45, 5,6,17,46, 9,10,20, 12,13,22, 40,47,41, 42,48,43, 21,49, 23,50, 26,37,27, 28,38,29, 32,33, 34,35],
                "X": [0,15, 8,7, 19,51, 30,31, 36,25, 24,39, 44,1],
                "p": [100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111] }

    @staticmethod
    def _gen_contract_tn(I,I_out): 
        return "C1",[0,1],"T1",[1,2,5,44],"T4",[0,15,3,6],"a",[I[0],2,3,16,45],"a.conj()",[I[1],5,6,17,46],\
        "T4_y",[15,8,9,12],"C4_y",[8,7],"T3_y",[10,13,7,19],"a_y",[I[6],16,9,10,20],"a_y.conj()",[I[7],17,12,13,22],\
        "T3_xy",[21,23,19,51],"a_xy",[I[8],47,20,21,49],"a_xy.conj()",[I[9],48,22,23,50],\
        "T1_2x",[39,26,28,24],"C2_2x",[24,25],"T2_2x",[25,27,29,36],"a_2x",[I[4],26,41,37,27],"a_2x.conj()",[I[5],28,43,38,29],\
        "T2_2xy",[36,33,35,31],"C3_2xy",[31,30],"T3_2xy",[32,34,51,30],"a_2xy",[I[10],37,49,32,33],"a_2xy.conj()",[I[11],38,50,34,35],\
        "T1_x",[44,40,42,39],"a_x",[I[2],40,45,47,41],"a_x.conj()",[I[3],42,46,48,43],I_out
    
    @classmethod
    def build_network(cls, D= 4, X= 64, p= 2, open_idx=[]):
        I= sum([[100+2*x,100+2*x+1] if x in open_idx else [100+2*x]*2 for x in [0,1,2,3,4,5]],[])
        I_out= [100+2*x for x in open_idx]+[100+2*x+1 for x in open_idx]

        dims= {"D": D, "X": X, "p": p}
        tn= cls._gen_contract_tn(I,I_out)

        inputs = [tuple(tn[i]) for i in range(1,len(tn)-1,2)] 
        output = tuple(tn[-1])
        size_dict = { idx: dims[k] for k in cls.idx_dims for idx in cls.idx_dims[k] }

        return inputs, output, size_dict